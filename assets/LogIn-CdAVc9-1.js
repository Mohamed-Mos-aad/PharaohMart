import{o as m,f,u as E,r as p,j as r,q as x}from"./index-DrBJZPAC.js";import{S as j}from"./SwitchAuth-Bej524J1.js";import{I as h}from"./InputElement-BsoiOuJp.js";import{a as y}from"./index-CR4Xcdnb.js";import{a as g,b as P}from"./axios.config-_zA4RlWj.js";const b="_auth_form_17roa_3",v={auth_form:b},_=async a=>{try{const s=await I(a),t=s.jwt;m("token",t);const n=await g.get(`/users/${s.user.id}?populate=*`);return m("userData",n.data),{success:!0,data:{user:s.user,jwt:s.jwt}}}catch(s){return P.isAxiosError(s)?{success:!1,error:{message:s.response?.data?.message||s.message,details:s.response?.data}}:{success:!1,error:{message:s instanceof Error?s.message:"Unknown error occurred",details:s}}}},I=async a=>{try{return(await g.post("/auth/local",{identifier:a.userEmail,password:a.userPassword})).data}catch(s){throw console.error("[Login Error]:",s),s}};function S(){const a=f(),s=E(),[t,n]=p.useState({userEmail:"",userPassword:""}),[i,u]=p.useState({userEmail:"",userPassword:""}),l=o=>{const{id:d,value:e}=o.currentTarget;n(c=>({...c,[d]:e}))},w=async()=>{const o=y(t);if(u(o),Object.values(o).every(e=>e===""))try{const e=await _(t);if(e.error?.message==="Request failed with status code 400"){u(c=>({...c,userEmail:"Invalid Emai or password"}));return}s(x(e.data?.user.roleType)),e.data?.user.roleType?.toLowerCase()==="seller"?a("/dashboard"):e.data?.user.roleType==="customer"&&a("/")}catch(e){console.log(e)}};return r.jsx(r.Fragment,{children:r.jsx("div",{className:"global_container",children:r.jsxs("div",{className:v.auth_form,children:[r.jsx("h1",{children:"Welcome back"}),r.jsx(h,{id:"userEmail",label:"Email",type:"text",name:"userEmail",error:i.userEmail,placeholder:"Email",onChange:l}),r.jsx(h,{id:"userPassword",label:"Password",type:"password",name:"userPassword",error:i.userPassword,placeholder:"Password",onChange:l}),r.jsx("button",{onClick:w,children:"Login"}),r.jsx(j,{to:"signup"})]})})})}export{S as default};
