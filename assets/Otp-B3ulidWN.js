import{d as D,l as q,r as m,j as i}from"./index-DaBHW3j3.js";import{b as z,a as L}from"./axios.config-B_oAmgeE.js";const U="_auth_form_1tn47_3",$="_otp_code_1tn47_43",S={auth_form:U,otp_code:$};class x{constructor(t=0,s="Network Error"){this.status=t,this.text=s}}const J=()=>{if(!(typeof localStorage>"u"))return{get:e=>Promise.resolve(localStorage.getItem(e)),set:(e,t)=>Promise.resolve(localStorage.setItem(e,t)),remove:e=>Promise.resolve(localStorage.removeItem(e))}},n={origin:"https://api.emailjs.com",blockHeadless:!1,storageProvider:J()},k=e=>e?typeof e=="string"?{publicKey:e}:e.toString()==="[object Object]"?e:{}:{},W=(e,t="https://api.emailjs.com")=>{if(!e)return;const s=k(e);n.publicKey=s.publicKey,n.blockHeadless=s.blockHeadless,n.storageProvider=s.storageProvider,n.blockList=s.blockList,n.limitRate=s.limitRate,n.origin=s.origin||t},_=async(e,t,s={})=>{const a=await fetch(n.origin+e,{method:"POST",headers:s,body:t}),o=await a.text(),c=new x(a.status,o);if(a.ok)return c;throw c},T=(e,t,s)=>{if(!e||typeof e!="string")throw"The public key is required. Visit https://dashboard.emailjs.com/admin/account";if(!t||typeof t!="string")throw"The service ID is required. Visit https://dashboard.emailjs.com/admin";if(!s||typeof s!="string")throw"The template ID is required. Visit https://dashboard.emailjs.com/admin/templates"},G=e=>{if(e&&e.toString()!=="[object Object]")throw"The template params have to be the object. Visit https://www.emailjs.com/docs/sdk/send/"},E=e=>e.webdriver||!e.languages||e.languages.length===0,C=()=>new x(451,"Unavailable For Headless Browser"),Q=(e,t)=>{if(!Array.isArray(e))throw"The BlockList list has to be an array";if(typeof t!="string")throw"The BlockList watchVariable has to be a string"},X=e=>!e.list?.length||!e.watchVariable,Y=(e,t)=>e instanceof FormData?e.get(t):e[t],R=(e,t)=>{if(X(e))return!1;Q(e.list,e.watchVariable);const s=Y(t,e.watchVariable);return typeof s!="string"?!1:e.list.includes(s)},H=()=>new x(403,"Forbidden"),Z=(e,t)=>{if(typeof e!="number"||e<0)throw"The LimitRate throttle has to be a positive number";if(t&&typeof t!="string")throw"The LimitRate ID has to be a non-empty string"},ee=async(e,t,s)=>{const a=Number(await s.get(e)||0);return t-Date.now()+a},I=async(e,t,s)=>{if(!t.throttle||!s)return!1;Z(t.throttle,t.id);const a=t.id||e;return await ee(a,t.throttle,s)>0?!0:(await s.set(a,Date.now().toString()),!1)},O=()=>new x(429,"Too Many Requests"),te=async(e,t,s,a)=>{const o=k(a),c=o.publicKey||n.publicKey,f=o.blockHeadless||n.blockHeadless,b=o.storageProvider||n.storageProvider,w={...n.blockList,...o.blockList},v={...n.limitRate,...o.limitRate};return f&&E(navigator)?Promise.reject(C()):(T(c,e,t),G(s),s&&R(w,s)?Promise.reject(H()):await I(location.pathname,v,b)?Promise.reject(O()):_("/api/v1.0/email/send",JSON.stringify({lib_version:"4.4.1",user_id:c,service_id:e,template_id:t,template_params:s}),{"Content-type":"application/json"}))},se=e=>{if(!e||e.nodeName!=="FORM")throw"The 3rd parameter is expected to be the HTML form element or the style selector of the form"},re=e=>typeof e=="string"?document.querySelector(e):e,oe=async(e,t,s,a)=>{const o=k(a),c=o.publicKey||n.publicKey,f=o.blockHeadless||n.blockHeadless,b=n.storageProvider||o.storageProvider,w={...n.blockList,...o.blockList},v={...n.limitRate,...o.limitRate};if(f&&E(navigator))return Promise.reject(C());const h=re(s);T(c,e,t),se(h);const p=new FormData(h);return R(w,p)?Promise.reject(H()):await I(location.pathname,v,b)?Promise.reject(O()):(p.append("lib_version","4.4.1"),p.append("service_id",e),p.append("template_id",t),p.append("user_id",c),_("/api/v1.0/email/send-form",p))},ne={init:W,send:te,sendForm:oe,EmailJSResponseStatus:x},ae={seller:4,customer:3},ie=async e=>{try{const t=await ce(e);return t?.user?.id?(await le(t.user.id,e,t.jwt),{success:!0,data:{user:t.user,jwt:t.jwt}}):{success:!1,error:{message:"Registration failed - no user ID returned",details:t}}}catch(t){return console.error("[SignUp Error]:",t),z.isAxiosError(t)?{success:!1,error:{message:t.response?.data?.message||t.message,details:t.response?.data}}:{success:!1,error:{message:t instanceof Error?t.message:"Unknown error occurred",details:t}}}},ce=async e=>{try{return(await L.post("/auth/local/register",{username:e.userFullName,email:e.userEmail,password:e.userPassword})).data}catch(t){throw console.error("[Register Error]:",t),t}},le=async(e,t,s)=>{const a=ae[t.role];try{L.put(`/users/${e}`,{role:a,roleType:t.role,phone:t.userPhoneNumber,...t.role==="seller"&&{storeName:t.userStoreName}},{headers:{Authorization:`Bearer ${s}`}})}catch(o){throw console.error("[Update Profile Error]:",o),o}};function me(){const{userData:e}=D(r=>r.signUp),t=q();e?.userEmail||t("/u/");const[s,a]=m.useState(Array(6).fill("")),[o,c]=m.useState({minutes:2,seconds:0}),[f,b]=m.useState(!1),[w,v]=m.useState(!1),[h,p]=m.useState(null),[K,P]=m.useState(!1),[M,N]=m.useState(!1),g=r=>{const{id:d,value:l}=r.currentTarget;if(!/^\d?$/.test(l))return;const u=parseInt(d),j=[...s];j[u]=l,a(j),l&&u<5&&document.getElementById((u+1).toString())?.focus()},y=r=>{const{key:d}=r,{id:l,value:u}=r.currentTarget,j=parseInt(l);d==="Backspace"&&!u&&j>0&&document.getElementById((j-1).toString())?.focus()},A=()=>{let r="";for(let d=0;d<6;d++)r+=Math.floor(Math.random()*10);return r},F=async()=>{if(e)try{N(!0),await ie({...e}),t("/u/success")}catch(r){console.log(r)}},V=()=>{const r=A();p(r),ne.send("service_e75s08c","template_unfxnz5",{passcode:r,email:e?.userEmail},{publicKey:"3PaUw5fPoj59Hzt83"}),v(!0),b(!0),c({minutes:2,seconds:0})};return m.useEffect(()=>{if(!f)return;const r=setInterval(()=>{c(d=>{let l=d.minutes,u=d.seconds-1;return u<0&&(u=59,l=l>0?l-1:0),l===0&&u===0&&clearInterval(r),{minutes:l,seconds:u}})},1e3);return()=>clearInterval(r)},[f,e]),m.useEffect(()=>{const r=s.join("");r.length===6&&P(r===h)},[s,h]),i.jsx(i.Fragment,{children:i.jsx("div",{className:"global_container",children:i.jsxs("div",{className:S.auth_form,children:[i.jsx("h1",{children:"Verify your identity"}),i.jsx("p",{children:"We sent a 6-digit verification code to your email address. Please enter it below to continue."}),i.jsxs("div",{className:S.otp_code,children:[i.jsx("input",{type:"text",id:"0",maxLength:1,inputMode:"numeric",value:s[0],pattern:"[0-9]*",onChange:r=>{g(r)},onKeyDown:y}),i.jsx("input",{type:"text",id:"1",maxLength:1,inputMode:"numeric",value:s[1],pattern:"[0-9]*",onChange:r=>{g(r)},onKeyDown:y}),i.jsx("input",{type:"text",id:"2",maxLength:1,inputMode:"numeric",value:s[2],pattern:"[0-9]*",onChange:r=>{g(r)},onKeyDown:y}),i.jsx("input",{type:"text",id:"3",maxLength:1,inputMode:"numeric",value:s[3],pattern:"[0-9]*",onChange:r=>{g(r)},onKeyDown:y}),i.jsx("input",{type:"text",id:"4",maxLength:1,inputMode:"numeric",value:s[4],pattern:"[0-9]*",onChange:r=>{g(r)},onKeyDown:y}),i.jsx("input",{type:"text",id:"5",maxLength:1,inputMode:"numeric",value:s[5],pattern:"[0-9]*",onChange:r=>{g(r)},onKeyDown:y})]}),i.jsxs("h2",{children:[o.minutes<10?"0"+o.minutes:o.minutes,":",o.seconds<10?"0"+o.seconds:o.seconds]}),w?i.jsx("button",{onClick:F,disabled:!K,children:M?"Save...":"Continue"}):i.jsx("button",{onClick:V,children:"Send Code"})]})})})}export{me as default};
