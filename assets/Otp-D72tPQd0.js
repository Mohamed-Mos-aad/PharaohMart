import{h as q,r as m,j as a}from"./index-BLNdKlxx.js";import{a as D}from"./hooks-B75tJxEl.js";const J="_auth_form_1tn47_3",$="_otp_code_1tn47_43",P={auth_form:J,otp_code:$};class x{constructor(s=0,t="Network Error"){this.status=s,this.text=t}}const z=()=>{if(!(typeof localStorage>"u"))return{get:e=>Promise.resolve(localStorage.getItem(e)),set:(e,s)=>Promise.resolve(localStorage.setItem(e,s)),remove:e=>Promise.resolve(localStorage.removeItem(e))}},n={origin:"https://api.emailjs.com",blockHeadless:!1,storageProvider:z()},S=e=>e?typeof e=="string"?{publicKey:e}:e.toString()==="[object Object]"?e:{}:{},W=(e,s="https://api.emailjs.com")=>{if(!e)return;const t=S(e);n.publicKey=t.publicKey,n.blockHeadless=t.blockHeadless,n.storageProvider=t.storageProvider,n.blockList=t.blockList,n.limitRate=t.limitRate,n.origin=t.origin||s},L=async(e,s,t={})=>{const i=await fetch(n.origin+e,{method:"POST",headers:t,body:s}),o=await i.text(),c=new x(i.status,o);if(i.ok)return c;throw c},_=(e,s,t)=>{if(!e||typeof e!="string")throw"The public key is required. Visit https://dashboard.emailjs.com/admin/account";if(!s||typeof s!="string")throw"The service ID is required. Visit https://dashboard.emailjs.com/admin";if(!t||typeof t!="string")throw"The template ID is required. Visit https://dashboard.emailjs.com/admin/templates"},G=e=>{if(e&&e.toString()!=="[object Object]")throw"The template params have to be the object. Visit https://www.emailjs.com/docs/sdk/send/"},C=e=>e.webdriver||!e.languages||e.languages.length===0,R=()=>new x(451,"Unavailable For Headless Browser"),Q=(e,s)=>{if(!Array.isArray(e))throw"The BlockList list has to be an array";if(typeof s!="string")throw"The BlockList watchVariable has to be a string"},U=e=>!e.list?.length||!e.watchVariable,X=(e,s)=>e instanceof FormData?e.get(s):e[s],O=(e,s)=>{if(U(e))return!1;Q(e.list,e.watchVariable);const t=X(s,e.watchVariable);return typeof t!="string"?!1:e.list.includes(t)},H=()=>new x(403,"Forbidden"),Y=(e,s)=>{if(typeof e!="number"||e<0)throw"The LimitRate throttle has to be a positive number";if(s&&typeof s!="string")throw"The LimitRate ID has to be a non-empty string"},Z=async(e,s,t)=>{const i=Number(await t.get(e)||0);return s-Date.now()+i},I=async(e,s,t)=>{if(!s.throttle||!t)return!1;Y(s.throttle,s.id);const i=s.id||e;return await Z(i,s.throttle,t)>0?!0:(await t.set(i,Date.now().toString()),!1)},K=()=>new x(429,"Too Many Requests"),ee=async(e,s,t,i)=>{const o=S(i),c=o.publicKey||n.publicKey,f=o.blockHeadless||n.blockHeadless,y=o.storageProvider||n.storageProvider,w={...n.blockList,...o.blockList},v={...n.limitRate,...o.limitRate};return f&&C(navigator)?Promise.reject(R()):(_(c,e,s),G(t),t&&O(w,t)?Promise.reject(H()):await I(location.pathname,v,y)?Promise.reject(K()):L("/api/v1.0/email/send",JSON.stringify({lib_version:"4.4.1",user_id:c,service_id:e,template_id:s,template_params:t}),{"Content-type":"application/json"}))},te=e=>{if(!e||e.nodeName!=="FORM")throw"The 3rd parameter is expected to be the HTML form element or the style selector of the form"},se=e=>typeof e=="string"?document.querySelector(e):e,re=async(e,s,t,i)=>{const o=S(i),c=o.publicKey||n.publicKey,f=o.blockHeadless||n.blockHeadless,y=n.storageProvider||o.storageProvider,w={...n.blockList,...o.blockList},v={...n.limitRate,...o.limitRate};if(f&&C(navigator))return Promise.reject(R());const h=se(t);_(c,e,s),te(h);const p=new FormData(h);return O(w,p)?Promise.reject(H()):await I(location.pathname,v,y)?Promise.reject(K()):(p.append("lib_version","4.4.1"),p.append("service_id",e),p.append("template_id",s),p.append("user_id",c),L("/api/v1.0/email/send-form",p))},oe={init:W,send:ee,sendForm:re,EmailJSResponseStatus:x},T="http://localhost:1337",ne=async e=>{try{const t=await(await fetch(`${T}/api/auth/local/register`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:e.userFullName,email:e.userEmail,password:e.userPassword})})).json();if(!t?.user?.id){console.log("Registration failed:",t);return}const i=t.user.id,o="2548e934592721c66eaf2a943f6ba8d9d5c12ea5e93631b70e252a68dded8b5d959d7f61eb958cc4a8b314e99b816222fc10e1ae1603ab13475557b86af9c62f225db96ba7ca642e2d2c19bbe51f88dc7a518670de597628985449bee4ce582ef0848545e6b23016fb30154603634ea2bb8ce73f5f22a3ecfabd88fdb40b1d99",c=e.role==="seller"?4:3;await fetch(`${T}/api/users/${i}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${o}`},body:JSON.stringify({role:c,roleType:e.role,phone:e.userPhoneNumber,...e.role==="seller"?{storeName:e.userStoreName}:{}})})}catch(s){console.log(s)}};function ce(){const{userData:e}=D(r=>r.signUp),s=q();e?.userEmail||s("/u/");const[t,i]=m.useState(Array(6).fill("")),[o,c]=m.useState({minutes:2,seconds:0}),[f,y]=m.useState(!1),[w,v]=m.useState(!1),[h,p]=m.useState(null),[E,k]=m.useState(!1),[N,M]=m.useState(!1),b=r=>{const{id:d,value:l}=r.currentTarget;if(!/^\d?$/.test(l))return;const u=parseInt(d),j=[...t];j[u]=l,i(j),l&&u<5&&document.getElementById((u+1).toString())?.focus()},g=r=>{const{key:d}=r,{id:l,value:u}=r.currentTarget,j=parseInt(l);d==="Backspace"&&!u&&j>0&&document.getElementById((j-1).toString())?.focus()},F=()=>{let r="";for(let d=0;d<6;d++)r+=Math.floor(Math.random()*10);return r},V=async()=>{if(e)try{M(!0),await ne({...e}),s("/u/success")}catch(r){console.log(r)}},B=()=>{const r=F();p(r),oe.send("service_e75s08c","template_unfxnz5",{passcode:r,email:e?.userEmail},{publicKey:"3PaUw5fPoj59Hzt83"}),v(!0),y(!0),c({minutes:2,seconds:0})};return m.useEffect(()=>{if(!f)return;const r=setInterval(()=>{c(d=>{let l=d.minutes,u=d.seconds-1;return u<0&&(u=59,l=l>0?l-1:0),l===0&&u===0&&clearInterval(r),{minutes:l,seconds:u}})},1e3);return()=>clearInterval(r)},[f,e]),m.useEffect(()=>{const r=t.join("");r.length===6&&k(r===h)},[t,h]),a.jsx(a.Fragment,{children:a.jsx("div",{className:"global_container",children:a.jsxs("div",{className:P.auth_form,children:[a.jsx("h1",{children:"Verify your identity"}),a.jsx("p",{children:"We sent a 6-digit verification code to your email address. Please enter it below to continue."}),a.jsxs("div",{className:P.otp_code,children:[a.jsx("input",{type:"text",id:"0",maxLength:1,inputMode:"numeric",value:t[0],pattern:"[0-9]*",onChange:r=>{b(r)},onKeyDown:g}),a.jsx("input",{type:"text",id:"1",maxLength:1,inputMode:"numeric",value:t[1],pattern:"[0-9]*",onChange:r=>{b(r)},onKeyDown:g}),a.jsx("input",{type:"text",id:"2",maxLength:1,inputMode:"numeric",value:t[2],pattern:"[0-9]*",onChange:r=>{b(r)},onKeyDown:g}),a.jsx("input",{type:"text",id:"3",maxLength:1,inputMode:"numeric",value:t[3],pattern:"[0-9]*",onChange:r=>{b(r)},onKeyDown:g}),a.jsx("input",{type:"text",id:"4",maxLength:1,inputMode:"numeric",value:t[4],pattern:"[0-9]*",onChange:r=>{b(r)},onKeyDown:g}),a.jsx("input",{type:"text",id:"5",maxLength:1,inputMode:"numeric",value:t[5],pattern:"[0-9]*",onChange:r=>{b(r)},onKeyDown:g})]}),a.jsxs("h2",{children:[o.minutes<10?"0"+o.minutes:o.minutes,":",o.seconds<10?"0"+o.seconds:o.seconds]}),w?a.jsx("button",{onClick:V,disabled:!E,children:N?"Save...":"Continue"}):a.jsx("button",{onClick:B,children:"Send Code"})]})})})}export{ce as default};
